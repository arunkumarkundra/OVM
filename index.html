<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OVM Assessment - Discover Your Optimization Profile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            max-width: 700px;
            width: 100%;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .screen {
            display: none;
            flex: 1;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        /* Welcome Screen */
        .welcome-screen {
            padding: 60px 40px;
            text-align: center;
            justify-content: center;
        }

        .welcome-screen h1 {
            color: #2d3748;
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .welcome-screen .subtitle {
            color: #667eea;
            font-size: 1.2rem;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .welcome-screen p {
            color: #4a5568;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .start-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        /* Progress Bar */
        .progress-container {
            height: 8px;
            background: #e2e8f0;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            padding: 20px 40px 0;
            color: #4a5568;
            font-size: 0.9rem;
            text-align: center;
        }

        /* Question Screen */
        .question-screen {
            padding: 40px;
            justify-content: center;
        }

        .question-card {
            text-align: center;
        }

        .question-card h2 {
            color: #2d3748;
            font-size: 1.5rem;
            margin-bottom: 40px;
            line-height: 1.4;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .option:hover {
            border-color: #667eea;
            background: #edf2f7;
            transform: translateY(-2px);
        }

        .option-text {
            color: #2d3748;
            font-size: 1rem;
            line-height: 1.4;
        }

        /* Results Screen */
        .results-screen {
            padding: 40px;
            overflow-y: auto;
        }

        .results-title {
            color: #2d3748;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 30px;
        }

        .result-section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f7fafc;
            border-radius: 15px;
        }

        .result-section h3 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .archetype-type {
            font-size: 2.5rem;
            font-weight: bold;
            color: #764ba2;
            text-align: center;
            margin: 20px 0;
        }

        .trait-bar {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .trait-label {
            width: 140px;
            font-weight: 600;
            color: #2d3748;
        }

        .trait-progress {
            flex: 1;
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            margin: 0 15px;
            overflow: hidden;
        }

        .trait-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            transition: width 0.8s ease;
        }

        .trait-score {
            width: 40px;
            text-align: center;
            font-weight: 600;
            color: #4a5568;
        }

        .recommendations {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .rec-column {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .rec-column.avoid {
            border-left-color: #e53e3e;
        }

        .rec-column h4 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .rec-column ul {
            list-style: none;
            padding: 0;
        }

        .rec-column li {
            color: #4a5568;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .rec-column li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #48bb78;
            font-weight: bold;
        }

        .rec-column.avoid li:before {
            content: "⚠";
            color: #e53e3e;
        }

        .career-insights {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .career-insights h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .career-section {
            margin-bottom: 20px;
        }

        .career-section h4 {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .career-section ul {
            list-style: none;
            padding: 0;
        }

        .career-section li {
            background: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
            padding: 10px 15px;
            border-radius: 8px;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
        }

        .scoring-explanation {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .scoring-explanation h4 {
            color: #2d3748;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .scoring-explanation .toggle {
            margin-left: 10px;
            font-size: 0.8em;
        }

        .scoring-explanation .content {
            color: #4a5568;
            font-size: 0.9em;
            line-height: 1.5;
            display: none;
        }

        .scoring-explanation .content.show {
            display: block;
        }

        .export-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .export-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .export-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .restart-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .restart-btn:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .welcome-screen {
                padding: 40px 30px;
            }

            .welcome-screen h1 {
                font-size: 2rem;
            }

            .question-screen {
                padding: 30px 25px;
            }

            .results-screen {
                padding: 30px 25px;
            }

            .recommendations {
                grid-template-columns: 1fr;
            }

            .export-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Welcome Screen -->
        <div class="screen active" id="welcome-screen">
            <div class="welcome-screen">
                <h1>OVM Assessment</h1>
                <div class="subtitle">Optimization Vectors Model</div>
                <p><strong>Discover what truly drives your life choices</strong></p>
                <p>This assessment reveals your optimization profile across five fundamental human drivers: Control, Growth, Status, Belonging, and Purpose. Understanding your unique combination helps you make better decisions about career, relationships, and personal development.</p>
                <p><strong>How it works:</strong> You'll see 25 paired choices. Simply select the option that feels more important to you when making life decisions. There are no right or wrong answers.</p>
                <p><em>Based on the Optimization Vectors Model (OVM) - a scientific framework for understanding human motivation.</em></p>
                <button class="start-btn" onclick="startAssessment()">Start Assessment</button>
            </div>
        </div>

        <!-- Question Screen -->
        <div class="screen" id="question-screen">
            <h1 style="text-align: center; color: #2d3748; font-size: 2rem; margin-bottom: 20px;">OVM Assessment</h1>

            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="progress-text" id="progress-text">Question 1 of 25</div>
            <div class="question-screen">
                <div class="question-card">
                    <h2 id="question-text"></h2>
                    <div class="options" id="options-container"></div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div class="screen" id="results-screen">
            <div class="results-screen">
                <h1 class="results-title">Your Optimization Profile</h1>
                
                <div class="result-section">
                    <h3>Your Archetype</h3>
                    <div class="archetype-type" id="archetype-type"></div>
                    <p id="archetype-description"></p>
                </div>

                <div class="scoring-explanation">
                    <h4 onclick="toggleScoringInfo()">How to Read This Report <span class="toggle">▼</span></h4>
                    <div class="content" id="scoring-content">
                        <p><strong>Driver Scores:</strong> Each driver score shows how often you chose options linked to that driver out of the total times it was offered to you. 100% means you chose it every time it appeared.</p>
                        <p><strong>Archetype Logic:</strong> <span id="archetype-logic"></span></p>
                        <p><strong>Question Balance:</strong> <span id="balance-info"></span></p>
                    </div>
                </div>

                <div class="result-section">
                    <h3>Optimization Vector Analysis</h3>
                    <p id="vector-analysis"></p>
                </div>

                <div class="result-section">
                    <h3>Your Optimization Drivers</h3>
                    <div id="optimization-drivers"></div>
                </div>

                <div class="career-insights">
                    <h3>🎯 Career & Professional Insights</h3>
                    <div id="career-content"></div>
                </div>

                <div class="result-section">
                    <h3>Life & Development Insights</h3>
                    <div class="recommendations">
                        <div class="rec-column">
                            <h4>✓ Strengths & Opportunities</h4>
                            <ul id="recommendations-strengths"></ul>
                        </div>
                        <div class="rec-column avoid">
                            <h4>⚠ Potential Blind Spots</h4>
                            <ul id="recommendations-blindspots"></ul>
                        </div>
                    </div>
                </div>

                <div class="result-section">
                    <p style="text-align: center; color: #667eea; font-style: italic;">
                        "Understanding your optimization drivers is the first step to intentional living. Use these insights to make choices that align with your authentic self."
                    </p>
                </div>

                <div class="export-buttons">
                    <button class="export-btn" onclick="downloadResults()">Download</button>
                    <button class="export-btn" onclick="shareAsImage()">Share</button>
                </div>

                <button class="restart-btn" onclick="restartAssessment()">Take Assessment Again</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration Constants
        const THRESHOLDS = {
            DOMINANT_DELTA: 15,
            DOMINANT_MIN: 60,
            HYBRID_MIN: 45,
            HYBRID_DELTA: 10,
            BALANCED_RANGE: 12
        };

        // Opposing pairs for conflict detection
        const OPPOSING_PAIRS = [
            ['Status', 'Purpose'],
            ['Control', 'Belonging'],
            ['Growth', 'Purpose'] // contextual opposition
        ];

        // Balanced OVM Questions (25 forced-choice pairs) - Each driver appears exactly 10 times
        const questions = [
            // Control vs Belonging (5 pairs)
            {
                question: "When making major life decisions, what matters more:",
                optionA: { text: "Having complete freedom to choose without external constraints", driver: "Control" },
                optionB: { text: "Being part of a trusted community or close relationships", driver: "Belonging" }
            },
            {
                question: "What would feel worse to you:",
                optionA: { text: "Being micromanaged or controlled by others", driver: "Control" },
                optionB: { text: "Feeling isolated or disconnected from your social circle", driver: "Belonging" }
            },
            {
                question: "Which statement resonates more with you:",
                optionA: { text: "I need the freedom to make my own choices", driver: "Control" },
                optionB: { text: "I need to feel accepted and valued by my community", driver: "Belonging" }
            },
            {
                question: "What motivates you most:",
                optionA: { text: "Protecting my independence at all costs", driver: "Control" },
                optionB: { text: "Staying deeply connected to people I care about", driver: "Belonging" }
            },
            {
                question: "In your ideal life, what matters most:",
                optionA: { text: "Being able to live completely on your own terms", driver: "Control" },
                optionB: { text: "Feeling deeply connected to those you care about most", driver: "Belonging" }
            },

            // Status vs Purpose (5 pairs)
            {
                question: "What would bring you more satisfaction:",
                optionA: { text: "Being recognized as highly accomplished in your field", driver: "Status" },
                optionB: { text: "Contributing to a cause that makes the world better", driver: "Purpose" }
            },
            {
                question: "Which achievement would mean more:",
                optionA: { text: "Winning a prestigious award or public recognition", driver: "Status" },
                optionB: { text: "Knowing your work serves a meaningful, higher purpose", driver: "Purpose" }
            },
            {
                question: "What brings you more fulfillment:",
                optionA: { text: "Achieving recognition for outstanding performance", driver: "Status" },
                optionB: { text: "Making sacrifices for something you believe in", driver: "Purpose" }
            },
            {
                question: "What motivates you most:",
                optionA: { text: "Being honored for my achievements", driver: "Status" },
                optionB: { text: "Staying faithful to my deepest principles", driver: "Purpose" }
            },
            {
                question: "Which type of recognition matters more:",
                optionA: { text: "Public acknowledgment of your superior achievements", driver: "Status" },
                optionB: { text: "Knowing you've stayed true to your moral compass", driver: "Purpose" }
            },

            // Growth vs Control (5 pairs)
            {
                question: "Which scenario appeals to you more:",
                optionA: { text: "A life filled with new challenges and learning opportunities", driver: "Growth" },
                optionB: { text: "A life with security, stability, and predictable outcomes", driver: "Control" }
            },
            {
                question: "What motivates you more:",
                optionA: { text: "Taking on projects that stretch your capabilities", driver: "Growth" },
                optionB: { text: "Having full autonomy over your work and decisions", driver: "Control" }
            },
            {
                question: "Which work environment suits you better:",
                optionA: { text: "Dynamic environments with constant change and innovation", driver: "Growth" },
                optionB: { text: "Stable environments where you can work independently", driver: "Control" }
            },
            {
                question: "What energizes you more:",
                optionA: { text: "Discovering new possibilities and pushing boundaries", driver: "Growth" },
                optionB: { text: "Having the power to make decisions without interference", driver: "Control" }
            },
            {
                question: "Which scenario would you prefer:",
                optionA: { text: "Complete independence, even if it means more uncertainty", driver: "Control" },
                optionB: { text: "Embracing uncertainty to grow and explore", driver: "Growth" }
            },

            // Status vs Belonging (5 pairs)
            {
                question: "What drives you more strongly:",
                optionA: { text: "Earning respect and admiration from peers", driver: "Status" },
                optionB: { text: "Building warm, trusting relationships with others", driver: "Belonging" }
            },
            {
                question: "Which matters more in your professional life:",
                optionA: { text: "Being seen as a leader or high performer", driver: "Status" },
                optionB: { text: "Having colleagues you genuinely care about and trust", driver: "Belonging" }
            },
            {
                question: "What's more important in your career:",
                optionA: { text: "Climbing to positions of influence and prestige", driver: "Status" },
                optionB: { text: "Working alongside people who feel like trusted community", driver: "Belonging" }
            },
            {
                question: "What motivates you most:",
                optionA: { text: "Earning admiration from others", driver: "Status" },
                optionB: { text: "Being accepted and cared for as I am", driver: "Belonging" }
            },
            {
                question: "In your professional relationships, what's more important:",
                optionA: { text: "Being respected as someone who achieves results", driver: "Status" },
                optionB: { text: "Being trusted as someone who genuinely cares", driver: "Belonging" }
            },

            // Growth vs Purpose (5 pairs)
            {
                question: "Which is more important to you:",
                optionA: { text: "Continuously expanding your skills and knowledge", driver: "Growth" },
                optionB: { text: "Living according to your deeply held values and beliefs", driver: "Purpose" }
            },
            {
                question: "What would you choose:",
                optionA: { text: "A role that constantly challenges you to learn new things", driver: "Growth" },
                optionB: { text: "A role that aligns perfectly with your personal mission", driver: "Purpose" }
            },
            {
                question: "Which approach to life appeals to you more:",
                optionA: { text: "Constantly seeking new experiences and personal development", driver: "Growth" },
                optionB: { text: "Dedicating yourself to serving others or a greater cause", driver: "Purpose" }
            },
            {
                question: "What motivates you most:",
                optionA: { text: "Advancing knowledge and discovery", driver: "Growth" },
                optionB: { text: "Living a life of devotion and service", driver: "Purpose" }
            },
            {
                question: "What legacy would you prefer to leave:",
                optionA: { text: "Being remembered as someone who never stopped learning and growing", driver: "Growth" },
                optionB: { text: "Being remembered as someone who made a meaningful difference", driver: "Purpose" }
            }
        ];

        // Enhanced Archetype Definitions with detailed career insights
        const archetypes = {
            "Control": {
                name: "The Maverick",
                description: "You optimize for freedom, autonomy, and independence. You want to shape your own path without being constrained by rules, institutions, or expectations.",
                strengths: ["Independent thinking", "Risk-taking courage", "Entrepreneurial spirit", "Adaptability", "Self-reliance"],
                blindSpots: ["May resist collaboration", "Can struggle with structure", "Risk of isolation", "Difficulty with authority", "May avoid long-term commitments"],
                careers: {
                    ideal: ["Entrepreneur", "Consultant", "Freelancer", "Creative Professional", "Sales Representative", "Real Estate Agent"],
                    workEnvironment: ["Remote work", "Flexible schedules", "Project-based roles", "Minimal supervision"],
                    avoid: ["Highly regulated industries", "Micromanagement", "Rigid corporate hierarchies", "Routine administrative work"]
                }
            },
            "Growth": {
                name: "The Explorer",
                description: "You optimize for learning, mastery, and novelty. You thrive on curiosity and the pursuit of new challenges and experiences.",
                strengths: ["Creative innovation", "Quick learning", "Adaptability", "Future orientation", "Inspiring curiosity"],
                blindSpots: ["May lack focus", "Restlessness with routine", "Can neglect practical needs", "Difficulty with completion", "Risk of overwhelming others"],
                careers: {
                    ideal: ["Research Scientist", "Product Manager", "UX Designer", "Startup Founder", "Management Consultant", "Learning & Development"],
                    workEnvironment: ["Innovation labs", "Cross-functional teams", "Continuous learning opportunities", "Variety in projects"],
                    avoid: ["Repetitive tasks", "Static roles", "Industries resistant to change", "Micromanagement of methods"]
                }
            },
            "Status": {
                name: "The Achiever",
                description: "You optimize for recognition, prestige, and competitive success. You're motivated by proving yourself and standing out from others.",
                strengths: ["High ambition", "Results orientation", "Competitive drive", "Leadership potential", "Goal achievement"],
                blindSpots: ["External validation dependence", "Burnout risk", "May neglect relationships", "Comparison trap", "Stress under pressure"],
                careers: {
                    ideal: ["Executive Leadership", "Investment Banking", "Corporate Law", "Sales Director", "Management Consulting", "Elite Professional Services"],
                    workEnvironment: ["Clear advancement paths", "Performance-based rewards", "Competitive settings", "High-visibility projects"],
                    avoid: ["Non-profit without growth potential", "Behind-the-scenes roles", "Flat organizational structures", "Unclear success metrics"]
                }
            },
            "Belonging": {
                name: "The Connector",
                description: "You optimize for relationships, intimacy, and community. You thrive when you feel bonded with others and part of something social.",
                strengths: ["Deep empathy", "Loyalty", "Emotional intelligence", "Harmony creation", "Supportive nature"],
                blindSpots: ["May sacrifice independence", "Conflict avoidance", "Over-dependence on others", "Difficulty with boundaries", "People-pleasing tendency"],
                careers: {
                    ideal: ["Human Resources", "Counseling/Therapy", "Team Leadership", "Community Management", "Healthcare", "Education"],
                    workEnvironment: ["Collaborative teams", "Strong company culture", "Mentorship opportunities", "People-focused missions"],
                    avoid: ["Highly competitive cultures", "Isolated work", "Frequent team changes", "Conflict-heavy environments"]
                }
            },
            "Purpose": {
                name: "The Seeker",
                description: "You optimize for meaning, ideals, and transcendence. You're motivated by living for something larger than yourself and making a meaningful impact.",
                strengths: ["Strong principles", "Resilience in adversity", "Inspiring vision", "Values-driven decisions", "Long-term perspective"],
                blindSpots: ["May neglect practical needs", "Risk of rigidity", "Self-sacrifice tendency", "Idealistic expectations", "Difficulty with compromise"],
                careers: {
                    ideal: ["Non-profit Leadership", "Social Impact", "Sustainable Business", "Ethics & Compliance", "Ministry/Spiritual Leadership", "Public Service"],
                    workEnvironment: ["Mission-driven organizations", "Values-aligned culture", "Social impact focus", "Ethical business practices"],
                    avoid: ["Purely profit-driven roles", "Ethically questionable industries", "Short-term focused positions", "Value-conflicting organizations"]
                }
            },
            "Control+Growth": {
                name: "The Pioneer",
                description: "You're independent and driven by discovery. You want freedom to chart your own path and thrive in uncharted territory.",
                strengths: ["Bold innovation", "Risk-taking", "Independent exploration", "Adaptable leadership", "Creative problem-solving"],
                blindSpots: ["May resist structure", "Restlessness", "Difficulty with routine", "Can be scattered", "May avoid commitment"],
                careers: {
                    ideal: ["Tech Entrepreneur", "Innovation Consultant", "Research & Development", "Venture Capital", "Creative Director", "Strategic Planning"],
                    workEnvironment: ["Startup environments", "R&D departments", "Innovation labs", "Project-based work"],
                    avoid: ["Bureaucratic organizations", "Routine operations", "Strict compliance roles", "Traditional corporate structures"]
                }
            },
            "Growth+Purpose": {
                name: "The Visionary",
                description: "You're an innovator with a mission. You explore not just for curiosity's sake, but to create meaningful impact.",
                strengths: ["Creative idealism", "Inspiring vision", "Future-oriented", "Values-driven innovation", "Motivating others"],
                blindSpots: ["Can overcommit", "May neglect practical needs", "Perfectionist tendencies", "Impatience with slow progress", "Risk of burnout"],
                careers: {
                    ideal: ["Social Innovation", "Sustainable Technology", "Educational Technology", "Healthcare Innovation", "Social Enterprise", "Think Tank Research"],
                    workEnvironment: ["Mission-driven startups", "Impact-focused organizations", "Research institutions", "Progressive companies"],
                    avoid: ["Purely commercial focus", "Short-term profit maximization", "Ethically neutral industries", "Incremental improvement roles"]
                }
            },
            "Status+Control": {
                name: "The Power Broker",
                description: "You want influence on your own terms. Ambition and autonomy combine into a drive for leadership and authority.",
                strengths: ["Strategic thinking", "Leadership ambition", "Independent decision-making", "Persuasive ability", "Results focus"],
                blindSpots: ["Risk of manipulation", "May be controlling", "Workaholic tendencies", "Difficulty trusting others", "Can alienate people"],
                careers: {
                    ideal: ["C-Suite Executive", "Investment Management", "Political Leadership", "Business Owner", "Elite Consulting", "Board Positions"],
                    workEnvironment: ["Leadership positions", "Decision-making authority", "Strategic roles", "High-stakes environments"],
                    avoid: ["Middle management", "Committee-based decisions", "Heavily regulated roles", "Supporting functions only"]
                }
            },
            "Status+Belonging": {
                name: "The Influencer",
                description: "You optimize for both admiration and connection. You want to be liked and respected, not just loved or just admired.",
                strengths: ["Social magnetism", "Network building", "Charismatic leadership", "People skills", "Bridge-building ability"],
                blindSpots: ["Image management pressure", "People-pleasing", "Authenticity challenges", "Fear of rejection", "May compromise values"],
                careers: {
                    ideal: ["Sales Leadership", "Public Relations", "Politics", "Media & Entertainment", "Corporate Communications", "Business Development"],
                    workEnvironment: ["People-facing roles", "Network-building opportunities", "Team leadership", "External relationship management"],
                    avoid: ["Behind-the-scenes work", "Technical specialization", "Conflict-heavy roles", "Isolated positions"]
                }
            },
            "Belonging+Purpose": {
                name: "The Caregiver",
                description: "You live to nurture and serve. Relationships are infused with a sense of mission, and service feels like destiny.",
                strengths: ["Deep compassion", "Service orientation", "Loyalty", "Empathy", "Community building"],
                blindSpots: ["Self-neglect", "Burnout risk", "Boundary issues", "Difficulty saying no", "May enable others"],
                careers: {
                    ideal: ["Healthcare", "Social Work", "Non-profit Management", "Teaching", "Ministry", "Human Services"],
                    workEnvironment: ["Service-oriented missions", "Supportive teams", "People-helping focus", "Community impact"],
                    avoid: ["Profit-maximizing roles", "Competitive environments", "Individual contributor roles", "Conflict-driven positions"]
                }
            },
            "Balanced": {
                name: "The Integrator",
                description: "You show balance across multiple optimization drivers. You're flexible and can adapt your focus based on context and needs.",
                strengths: ["Flexibility", "Balanced perspective", "Adaptability", "Well-rounded approach", "Context sensitivity"],
                blindSpots: ["May lack clear direction", "Decision paralysis risk", "Less intense drive", "May seem unfocused", "Identity uncertainty"],
                careers: {
                    ideal: ["General Management", "Project Management", "Operations", "HR Leadership", "Strategy & Planning", "Organizational Development"],
                    workEnvironment: ["Diverse responsibilities", "Cross-functional roles", "Balanced organizations", "Varied projects"],
                    avoid: ["Highly specialized roles", "Single-focus positions", "Extreme cultures", "One-dimensional work"]
                }
            }
        };

        // Assessment State
        let currentQuestion = 0;
        let answers = [];
        let scores = {
            Control: 0,
            Growth: 0,
            Status: 0,
            Belonging: 0,
            Purpose: 0
        };
        let shuffledQuestions = [];
        let appearanceCount = {};

        // Initialize assessment
        function initializeAssessment() {
            // Calculate appearance count for each driver
            appearanceCount = { Control: 0, Growth: 0, Status: 0, Belonging: 0, Purpose: 0 };
            questions.forEach(q => {
                appearanceCount[q.optionA.driver]++;
                appearanceCount[q.optionB.driver]++;
            });

            // Verify balanced question set
            const targetAppearance = Math.round((questions.length * 2) / 5);
            const balanceCheck = Object.values(appearanceCount).every(count => count === targetAppearance);
            
            if (!balanceCheck) {
                console.warn('Question set is not balanced:', appearanceCount);
            }

            // Shuffle questions for randomization
            shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);
        }

        // Start Assessment
        function startAssessment() {
            initializeAssessment();
            showScreen('question-screen');
            displayQuestion();
        }

        // Display Current Question
        function displayQuestion() {
            const question = shuffledQuestions[currentQuestion];
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('progress-text').textContent = `Question ${currentQuestion + 1} of ${shuffledQuestions.length}`;
            
            // Update progress bar
            const progress = ((currentQuestion + 1) / shuffledQuestions.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';

            // Create options with randomized A/B order
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            // Randomly swap option order (50/50)
            const shouldSwap = Math.random() < 0.5;
            const firstOption = shouldSwap ? question.optionB : question.optionA;
            const secondOption = shouldSwap ? question.optionA : question.optionB;

            const option1 = createOption('1', firstOption);
            const option2 = createOption('2', secondOption);
            
            optionsContainer.appendChild(option1);
            optionsContainer.appendChild(option2);
        }

        // Create Option Element
        function createOption(letter, option) {
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option';
            optionDiv.innerHTML = `<div class="option-text">${option.text}</div>`;
            
            optionDiv.addEventListener('click', () => selectAnswer(option));
            return optionDiv;
        }

        // Handle Answer Selection
        function selectAnswer(selectedOption) {
            answers.push(selectedOption);
            scores[selectedOption.driver]++;

            currentQuestion++;

            // Move to next question or show results
            if (currentQuestion < shuffledQuestions.length) {
                setTimeout(() => displayQuestion(), 300);
            } else {
                setTimeout(() => showResults(), 500);
            }
        }

        // Show Results
        function showResults() {
            calculateResults();
            showScreen('results-screen');
            animateResults();
        }

        // Calculate Final Results with Enhanced Algorithm
        function calculateResults() {
            // Calculate correct percentages using appearance count
            const absolutePercentages = {};
            for (const [driver, score] of Object.entries(scores)) {
                absolutePercentages[driver] = Math.round((score / appearanceCount[driver]) * 100);
            }

            // Determine archetype with improved logic
            const sortedDrivers = Object.entries(absolutePercentages).sort((a, b) => b[1] - a[1]);
            const topDriver = sortedDrivers[0];
            const secondDriver = sortedDrivers[1];

            let archetype;
            let archetypeLogic = "";
            let isHybrid = false;
            let isConflict = false;

            // Check for conflict first
            const conflictPair = OPPOSING_PAIRS.find(pair => 
                (pair.includes(topDriver[0]) && pair.includes(secondDriver[0])) &&
                topDriver[1] >= 50 && secondDriver[1] >= 50
            );

            if (conflictPair) {
                isConflict = true;
                archetype = topDriver[0] + '+' + secondDriver[0];
                archetypeLogic = `Conflict profile detected: High scores in opposing drivers ${topDriver[0]} (${topDriver[1]}%) and ${secondDriver[0]} (${secondDriver[1]}%)`;
            }
            // Check for hybrid
            else if (topDriver[1] >= THRESHOLDS.HYBRID_MIN && 
                     secondDriver[1] >= THRESHOLDS.HYBRID_MIN && 
                     (topDriver[1] - secondDriver[1]) <= THRESHOLDS.HYBRID_DELTA) {
                const hybridKey = [topDriver[0], secondDriver[0]].sort().join('+');
                if (archetypes[hybridKey]) {
                    archetype = hybridKey;
                    isHybrid = true;
                    archetypeLogic = `Hybrid archetype: ${topDriver[0]} (${topDriver[1]}%) and ${secondDriver[0]} (${secondDriver[1]}%) within ${THRESHOLDS.HYBRID_DELTA}% of each other`;
                } else {
                    archetype = topDriver[0] + '+' + secondDriver[0];
                    isHybrid = true;
                    archetypeLogic = `Dynamic hybrid: ${topDriver[0]} (${topDriver[1]}%) and ${secondDriver[0]} (${secondDriver[1]}%) are co-dominant`;
                }
            }
            // Check for balanced
            else {
                const maxScore = Math.max(...Object.values(absolutePercentages));
                const minScore = Math.min(...Object.values(absolutePercentages));
                if (maxScore - minScore <= THRESHOLDS.BALANCED_RANGE) {
                    archetype = "Balanced";
                    archetypeLogic = `Balanced profile: All drivers within ${THRESHOLDS.BALANCED_RANGE}% range (${minScore}%-${maxScore}%)`;
                }
                // Check for dominant
                else if (topDriver[1] >= THRESHOLDS.DOMINANT_MIN && 
                         (topDriver[1] - secondDriver[1]) >= THRESHOLDS.DOMINANT_DELTA) {
                    archetype = topDriver[0];
                    archetypeLogic = `Dominant archetype: ${topDriver[0]} (${topDriver[1]}%) is ${topDriver[1] - secondDriver[1]}% higher than second driver`;
                }
                // Default to single archetype
                else {
                    archetype = topDriver[0];
                    archetypeLogic = `Primary archetype: ${topDriver[0]} (${topDriver[1]}%) is your leading driver`;
                }
            }

            // Handle archetype data
            let archetypeData;
            if (archetypes[archetype]) {
                archetypeData = archetypes[archetype];
            } else if (isHybrid || isConflict) {
                archetypeData = createDynamicHybrid(topDriver[0], secondDriver[0], isConflict);
            } else {
                archetypeData = archetypes[topDriver[0]];
            }

            // Display results
            document.getElementById('archetype-type').textContent = archetypeData.name;
            document.getElementById('archetype-description').textContent = archetypeData.description;
            
            // Display scoring information
            document.getElementById('archetype-logic').textContent = archetypeLogic;
            const balanceInfo = `Each driver appeared ${Object.values(appearanceCount)[0]} times. ${Object.entries(appearanceCount).map(([driver, count]) => `${driver}: ${count}`).join(', ')}`;
            document.getElementById('balance-info').textContent = balanceInfo;
            
            // Generate analysis
            generateVectorAnalysis(absolutePercentages, archetype, topDriver, secondDriver);
            
            // Display optimization drivers
            displayOptimizationDrivers(absolutePercentages);
            
            // Display career insights
            displayCareerInsights(archetypeData, absolutePercentages);
            
            // Display recommendations
            displayRecommendations(archetypeData);
            
            // Store results for export
            window.assessmentResults = {
                archetype: archetypeData.name,
                archetypeDescription: archetypeData.description,
                absolutePercentages,
                archetypeLogic,
                vectorAnalysis: generateVectorAnalysisText(absolutePercentages, archetype, topDriver, secondDriver),
                strengths: archetypeData.strengths,
                blindSpots: archetypeData.blindSpots,
                careerInsights: archetypeData.careers
            };
        }

        // Create dynamic hybrid archetype
        function createDynamicHybrid(driver1, driver2, isConflict = false) {
            const driverNames = {
                Control: "Maverick",
                Growth: "Explorer", 
                Status: "Achiever",
                Belonging: "Connector",
                Purpose: "Seeker"
            };

            const base1 = archetypes[driver1];
            const base2 = archetypes[driver2];

            const hybridName = isConflict ? 
                `The ${driverNames[driver1]}-${driverNames[driver2]} (Conflict)` :
                `The ${driverNames[driver1]}-${driverNames[driver2]}`;

            const hybridDescription = isConflict ?
                `You experience internal tension between ${driver1.toLowerCase()} and ${driver2.toLowerCase()}. This creates a complex dynamic where you simultaneously seek ${getDriverDescription(driver1)} while also prioritizing ${getDriverDescription(driver2)}, which can create internal conflicts requiring careful balance.` :
                `You optimize for both ${driver1.toLowerCase()} and ${driver2.toLowerCase()}. This creates a unique blend where you seek ${getDriverDescription(driver1)} while also prioritizing ${getDriverDescription(driver2)}.`;

            return {
                name: hybridName,
                description: hybridDescription,
                strengths: [...base1.strengths.slice(0, 3), ...base2.strengths.slice(0, 2)],
                blindSpots: [...base1.blindSpots.slice(0, 3), ...base2.blindSpots.slice(0, 2)],
                careers: {
                    ideal: [...base1.careers.ideal.slice(0, 3), ...base2.careers.ideal.slice(0, 3)],
                    workEnvironment: [...base1.careers.workEnvironment.slice(0, 2), ...base2.careers.workEnvironment.slice(0, 2)],
                    avoid: [...base1.careers.avoid.slice(0, 2), ...base2.careers.avoid.slice(0, 2)]
                }
            };
        }

        function getDriverDescription(driver) {
            const descriptions = {
                Control: "autonomy and independence",
                Growth: "learning and exploration", 
                Status: "recognition and achievement",
                Belonging: "relationships and community",
                Purpose: "meaning and values"
            };
            return descriptions[driver];
        }

        // Generate Vector Analysis
        function generateVectorAnalysis(absolutePercentages, archetype, topDriver, secondDriver) {
            const analysis = generateVectorAnalysisText(absolutePercentages, archetype, topDriver, secondDriver);
            document.getElementById('vector-analysis').textContent = analysis;
        }

        // Generate Vector Analysis Text
        function generateVectorAnalysisText(absolutePercentages, archetype, topDriver, secondDriver) {
            let analysis = `Your optimization profile shows ${topDriver[0]} as your primary driver (${topDriver[1]}%)`;
            
            if (topDriver[1] - secondDriver[1] <= THRESHOLDS.HYBRID_DELTA && secondDriver[1] >= THRESHOLDS.HYBRID_MIN) {
                analysis += ` with an equally strong drive for ${secondDriver[0]} (${secondDriver[1]}%). `;
                analysis += `This dual optimization creates a dynamic where you simultaneously seek ${getDriverDescription(topDriver[0])} and ${getDriverDescription(secondDriver[0])}, `;
                analysis += `which can create both synergies and interesting tensions in your decision-making.`;
            } else if (secondDriver[1] >= 30) {
                analysis += ` with significant secondary optimization for ${secondDriver[0]} (${secondDriver[1]}%). `;
                analysis += `While ${topDriver[0].toLowerCase()} is your primary motivator, ${secondDriver[0].toLowerCase()} plays an important supporting role in your life choices.`;
            } else {
                analysis += `, significantly outweighing other factors. `;
                analysis += `Your life choices are primarily guided by your drive for ${getDriverDescription(topDriver[0])}.`;
            }

            const lowestDriver = Object.entries(absolutePercentages).sort((a, b) => a[1] - b[1])[0];
            if (lowestDriver[1] <= 20) {
                analysis += ` You show minimal optimization for ${lowestDriver[0]} (${lowestDriver[1]}%), suggesting this is not a significant factor in your decision-making process.`;
            }

            return analysis;
        }

        // Display Optimization Drivers
        function displayOptimizationDrivers(absolutePercentages) {
            const driversContainer = document.getElementById('optimization-drivers');
            driversContainer.innerHTML = '';

            const driverDescriptions = {
                Control: 'Autonomy & Freedom',
                Growth: 'Learning & Mastery',
                Status: 'Recognition & Achievement',
                Belonging: 'Relationships & Community',
                Purpose: 'Meaning & Values'
            };

            // Sort drivers by score for better visualization
            const sortedDrivers = Object.entries(absolutePercentages).sort((a, b) => b[1] - a[1]);

            sortedDrivers.forEach(([driver, score]) => {
                const driverDiv = document.createElement('div');
                driverDiv.className = 'trait-bar';
                
                driverDiv.innerHTML = `
                    <div class="trait-label">${driverDescriptions[driver]}</div>
                    <div class="trait-progress">
                        <div class="trait-fill" data-width="${score}"></div>
                    </div>
                    <div class="trait-score">${score}%</div>
                `;
                
                driversContainer.appendChild(driverDiv);
            });
        }

        // Display Career Insights
        function displayCareerInsights(archetypeData, absolutePercentages) {
            const careerContainer = document.getElementById('career-content');
            const careers = archetypeData.careers;
            
            careerContainer.innerHTML = `
                <div class="career-section">
                    <h4>🎯 Ideal Career Paths</h4>
                    <ul>
                        ${careers.ideal.map(career => `<li>${career}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="career-section">
                    <h4>🏢 Optimal Work Environment</h4>
                    <ul>
                        ${careers.workEnvironment.map(env => `<li>${env}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="career-section">
                    <h4>⚠️ Career Situations to Avoid</h4>
                    <ul>
                        ${careers.avoid.map(avoid => `<li>${avoid}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="career-section">
                    <h4>💡 Professional Development Focus</h4>
                    <ul>
                        ${generateDevelopmentTips(archetypeData, absolutePercentages).map(tip => `<li>${tip}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        // Generate Development Tips
        function generateDevelopmentTips(archetypeData, absolutePercentages) {
            const sortedDrivers = Object.entries(absolutePercentages).sort((a, b) => b[1] - a[1]);
            const topDriver = sortedDrivers[0][0];
            const lowestDriver = sortedDrivers[4][0];
            
            const tips = [];
            
            // Tips based on top driver
            const topDriverTips = {
                Control: ["Seek roles with autonomy and decision-making authority", "Develop entrepreneurial skills"],
                Growth: ["Pursue continuous learning opportunities", "Take on stretch assignments"],
                Status: ["Build a strong professional brand", "Seek leadership development programs"],
                Belonging: ["Develop strong networking and relationship skills", "Consider team leadership roles"],
                Purpose: ["Align career with personal values", "Seek mission-driven organizations"]
            };
            
            tips.push(...topDriverTips[topDriver]);
            
            // Development area based on lowest driver
            const developmentAreas = {
                Control: "Practice delegation and collaborative decision-making",
                Growth: "Build patience for routine tasks and long-term consistency",
                Status: "Develop intrinsic motivation beyond external recognition",
                Belonging: "Strengthen individual contributor skills and self-reliance",
                Purpose: "Balance idealism with practical business considerations"
            };
            
            tips.push(developmentAreas[lowestDriver]);
            
            return tips;
        }

        // Display Recommendations
        function displayRecommendations(archetypeData) {
            const strengthsContainer = document.getElementById('recommendations-strengths');
            const blindSpotsContainer = document.getElementById('recommendations-blindspots');
            
            strengthsContainer.innerHTML = '';
            blindSpotsContainer.innerHTML = '';

            archetypeData.strengths.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                strengthsContainer.appendChild(li);
            });

            archetypeData.blindSpots.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                blindSpotsContainer.appendChild(li);
            });
        }

        // Toggle scoring explanation
        function toggleScoringInfo() {
            const content = document.getElementById('scoring-content');
            const toggle = document.querySelector('.toggle');
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                toggle.textContent = '▼';
            } else {
                content.classList.add('show');
                toggle.textContent = '▲';
            }
        }

        // Animate Results
        function animateResults() {
            setTimeout(() => {
                const traitFills = document.querySelectorAll('.trait-fill');
                traitFills.forEach(fill => {
                    const width = fill.dataset.width;
                    fill.style.width = width + '%';
                });
            }, 500);
        }

        // Export Functions
        function downloadResults() {
            const results = window.assessmentResults;
            const timestamp = new Date().toLocaleString();
            const currentURL = window.location.href;
            const fileTimestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '').replace('T', '_');
            
            const htmlContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>OVM Assessment Results</title>
                <style>
                    body { 
                        font-family: Arial, sans-serif; 
                        line-height: 1.6; 
                        color: #333; 
                        max-width: 800px; 
                        margin: 0 auto; 
                        padding: 20px;
                        background: white;
                    }
                    .header { 
                        text-align: center; 
                        border-bottom: 3px solid #667eea; 
                        padding-bottom: 20px; 
                        margin-bottom: 30px;
                    }
                    .header h1 { 
                        color: #667eea; 
                        font-size: 2.5em; 
                        margin: 0;
                    }
                    .archetype-section { 
                        background: linear-gradient(135deg, #667eea, #764ba2); 
                        color: white; 
                        padding: 30px; 
                        border-radius: 15px; 
                        text-align: center; 
                        margin-bottom: 30px;
                    }
                    .archetype-type { 
                        font-size: 3em; 
                        font-weight: bold; 
                        margin: 10px 0;
                    }
                    .section { 
                        margin-bottom: 30px; 
                        padding: 20px; 
                        background: #f8f9fa; 
                        border-radius: 10px; 
                        border-left: 5px solid #667eea;
                    }
                    .section h2 { 
                        color: #667eea; 
                        margin-top: 0;
                        font-size: 1.5em;
                    }
                    .career-section {
                        background: linear-gradient(135deg, #48bb78, #38a169);
                        color: white;
                        padding: 25px;
                        border-radius: 15px;
                        margin-bottom: 20px;
                    }
                    .career-section h3 {
                        color: white;
                        margin-bottom: 15px;
                    }
                    .driver-item { 
                        display: flex; 
                        justify-content: space-between; 
                        margin: 10px 0; 
                        padding: 8px 0;
                        border-bottom: 1px solid #dee2e6;
                    }
                    .recommendations { 
                        display: grid; 
                        grid-template-columns: 1fr 1fr; 
                        gap: 20px; 
                        margin-top: 20px;
                    }
                    .rec-column { 
                        background: white; 
                        padding: 20px; 
                        border-radius: 10px; 
                        border-left: 5px solid #48bb78;
                    }
                    .rec-column.blindspots { 
                        border-left-color: #e53e3e;
                    }
                    .rec-column h3 { 
                        margin-top: 0; 
                        color: #2d3748;
                    }
                    .rec-column ul { 
                        list-style: none; 
                        padding: 0;
                    }
                    .rec-column li { 
                        margin: 8px 0; 
                        padding-left: 20px; 
                        position: relative;
                    }
                    .rec-column li:before { 
                        content: "✓"; 
                        position: absolute; 
                        left: 0; 
                        color: #48bb78; 
                        font-weight: bold;
                    }
                    .rec-column.blindspots li:before { 
                        content: "⚠"; 
                        color: #e53e3e;
                    }
                    .footer { 
                        margin-top: 50px; 
                        padding-top: 20px; 
                        border-top: 2px solid #dee2e6; 
                        text-align: center; 
                        color: #6c757d; 
                        font-size: 0.9em;
                    }
                    @media print {
                        body { margin: 0; padding: 15px; }
                        .recommendations { grid-template-columns: 1fr; }
                    }
                </style>
            </head>
            <body>
                <div class="header">
                    <h1>OVM Assessment Results</h1>
                    <p style="margin: 10px 0; color: #667eea; font-size: 1.2em;">Optimization Vectors Model</p>
                </div>
                
                <div class="archetype-section">
                    <div class="archetype-type">${results.archetype}</div>
                    <p style="font-size: 1.2em; margin: 0;">${results.archetypeDescription}</p>
                </div>

                <div class="section">
                    <h2>Optimization Vector Analysis</h2>
                    <p>${results.vectorAnalysis}</p>
                    <p><strong>Classification Logic:</strong> ${results.archetypeLogic}</p>
                </div>

                <div class="section">
                    <h2>Your Optimization Drivers</h2>
                    ${Object.entries(results.absolutePercentages).sort((a, b) => b[1] - a[1]).map(([driver, score]) => `
                        <div class="driver-item">
                            <span><strong>${driver} (${getDriverFullDescription(driver)}):</strong></span>
                            <span><strong>${score}%</strong></span>
                        </div>
                    `).join('')}
                </div>

                <div class="career-section">
                    <h2 style="color: white;">🎯 Career & Professional Insights</h2>
                    <h3>Ideal Career Paths</h3>
                    <ul style="list-style: none; padding: 0;">
                        ${results.careerInsights.ideal.map(career => `<li style="margin: 5px 0;">• ${career}</li>`).join('')}
                    </ul>
                    <h3>Optimal Work Environment</h3>
                    <ul style="list-style: none; padding: 0;">
                        ${results.careerInsights.workEnvironment.map(env => `<li style="margin: 5px 0;">• ${env}</li>`).join('')}
                    </ul>
                    <h3>Career Situations to Avoid</h3>
                    <ul style="list-style: none; padding: 0;">
                        ${results.careerInsights.avoid.map(avoid => `<li style="margin: 5px 0;">• ${avoid}</li>`).join('')}
                    </ul>
                </div>

                <div class="section">
                    <h2>Life & Development Insights</h2>
                    <div class="recommendations">
                        <div class="rec-column">
                            <h3>✓ Strengths & Opportunities</h3>
                            <ul>
                                ${results.strengths.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="rec-column blindspots">
                            <h3>⚠ Potential Blind Spots</h3>
                            <ul>
                                ${results.blindSpots.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="footer">
                    <p><strong>Generated on:</strong> ${timestamp}</p>
                    <p><strong>Take your free OVM assessment:</strong> <a href="${currentURL}" target="_blank">${currentURL}</a></p>
                    <p><em>Based on the Optimization Vectors Model (OVM) - A scientific framework for understanding human motivation</em></p>
                </div>
            </body>
            </html>`;

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ovm-assessment-${results.archetype.replace(/\s+/g, '-').toLowerCase()}-${fileTimestamp}.html`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function getDriverFullDescription(driver) {
            const descriptions = {
                Control: 'Autonomy & Freedom',
                Growth: 'Learning & Mastery',
                Status: 'Recognition & Achievement',
                Belonging: 'Relationships & Community',
                Purpose: 'Meaning & Values'
            };
            return descriptions[driver];
        }

        function shareAsImage() {
            const resultsContent = document.querySelector('#results-screen .results-screen');
            if (!resultsContent) {
                alert('Results content not found. Please complete the assessment first.');
                return;
            }
        
            // Temporarily hide the buttons for the screenshot
            const buttonsSection = document.querySelector('.export-buttons');
            const restartButton = document.querySelector('.restart-btn');
            const originalDisplayButtons = buttonsSection ? buttonsSection.style.display : null;
            const originalDisplayRestart = restartButton ? restartButton.style.display : null;
            if (buttonsSection) buttonsSection.style.display = 'none';
            if (restartButton) restartButton.style.display = 'none';
            
            // Create footer for the image
            const footerElement = document.createElement('div');
            footerElement.style.textAlign = 'center';
            footerElement.style.padding = '20px 0 10px';
            footerElement.style.borderTop = '1px solid #e2e8f0';
            footerElement.style.color = '#718096';
            footerElement.style.fontSize = '12px';
            footerElement.innerHTML = `
                <p>Generated on: ${new Date().toLocaleString()}</p>
                <p>Take your free OVM assessment: <a href="${window.location.href}">${window.location.href}</a></p>
                <p><em>Based on the Optimization Vectors Model (OVM)</em></p>
            `;
            
            // Clone the results screen content
            const contentToCapture = resultsContent.cloneNode(true);
            contentToCapture.style.backgroundColor = 'white';
            contentToCapture.style.padding = '40px';
            contentToCapture.style.minHeight = 'auto';
            contentToCapture.appendChild(footerElement);
        
            // Create temporary container
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            tempContainer.style.top = '-9999px';
            tempContainer.style.width = '600px';
            tempContainer.style.background = 'white';
            tempContainer.appendChild(contentToCapture);
            document.body.appendChild(tempContainer);
        
            html2canvas(contentToCapture, {
                scale: 2,
                backgroundColor: null
            }).then(canvas => {
                tempContainer.remove();
        
                const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '').replace('T', '_');
                const filename = `ovm-assessment-results-${timestamp}.png`;
                const shareMessage = generateShareMessage(window.assessmentResults, window.location.href);
        
                // Restore button visibility
                if (buttonsSection) buttonsSection.style.display = originalDisplayButtons;
                if (restartButton) restartButton.style.display = originalDisplayRestart;
        
                // Check for Web Share API support
                if (navigator.share) {
                    canvas.toBlob(blob => {
                        const file = new File([blob], filename, { type: 'image/png' });
                        navigator.share({
                            files: [file],
                            title: 'My OVM Assessment Results',
                            text: shareMessage
                        }).catch(error => {
                            console.error('Sharing failed:', error);
                            downloadCanvasImage(canvas, filename);
                            alert("Sharing failed. The image has been downloaded instead.");
                        });
                    });
                } else {
                    downloadCanvasImage(canvas, filename);
                    if (navigator.clipboard && shareMessage) {
                        navigator.clipboard.writeText(shareMessage).then(() => {
                            alert("Image downloaded! A shareable message has been copied to your clipboard.");
                        }).catch(err => {
                            console.error('Clipboard write failed:', err);
                            alert("Image downloaded! You'll need to manually copy the share message.");
                        });
                    } else {
                        alert("Image downloaded! Your browser doesn't support the 'Share' function or clipboard access.");
                    }
                }
            }).catch(error => {
                console.error('Error generating image:', error);
                if (buttonsSection) buttonsSection.style.display = originalDisplayButtons;
                if (restartButton) restartButton.style.display = originalDisplayRestart;
                alert('Failed to create a shareable image. Please try again.');
            });
        }

        function downloadCanvasImage(canvas, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function generateShareMessage(results, url) {
            const messages = [
                `Just discovered I'm ${results.archetype}! 🎯 The OVM assessment revealed fascinating insights about what truly drives my decisions.`,
                `My optimization profile shows I'm ${results.archetype}! 💫 Really eye-opening to understand my core motivational drivers.`,
                `Took the OVM assessment and learned I'm ${results.archetype}! 🧠 The insights about my optimization patterns were spot-on.`,
                `Found out I'm ${results.archetype} through this comprehensive motivation assessment! ✨ Understanding what I optimize for is so valuable.`
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            
            let shareText = `${randomMessage}\n\nDiscover what drives your life choices with the free OVM Assessment: ${url}\n\n#OVM #OptimizationVectors #PersonalityAssessment #Motivation #${results.archetype.replace(/\s+/g, '')}`;
            
            return shareText;
        }

        // Utility Functions
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function restartAssessment() {
            // Reset all variables
            currentQuestion = 0;
            answers = [];
            scores = {
                Control: 0,
                Growth: 0,
                Status: 0,
                Belonging: 0,
                Purpose: 0
            };
            shuffledQuestions = [];
            
            // Show welcome screen
            showScreen('welcome-screen');
        }

        // Debug function for testing (can be called from console)
        function debugSimulateProfile(driverChoice, iterations = 25) {
            console.log(`Simulating ${iterations} choices for ${driverChoice}:`);
            
            // Reset scores
            const testScores = { Control: 0, Growth: 0, Status: 0, Belonging: 0, Purpose: 0 };
            
            // Count appearances
            const testAppearanceCount = { Control: 0, Growth: 0, Status: 0, Belonging: 0, Purpose: 0 };
            questions.forEach(q => {
                testAppearanceCount[q.optionA.driver]++;
                testAppearanceCount[q.optionB.driver]++;
            });
            
            // Simulate choosing the target driver whenever it appears
            questions.forEach(q => {
                if (q.optionA.driver === driverChoice) {
                    testScores[driverChoice]++;
                } else if (q.optionB.driver === driverChoice) {
                    testScores[driverChoice]++;
                } else {
                    // Choose randomly between the two options when target driver not present
                    const randomChoice = Math.random() < 0.5 ? q.optionA.driver : q.optionB.driver;
                    testScores[randomChoice]++;
                }
            });
            
            // Calculate percentages
            const testPercentages = {};
            for (const [driver, score] of Object.entries(testScores)) {
                testPercentages[driver] = Math.round((score / testAppearanceCount[driver]) * 100);
            }
            
            console.log('Appearance counts:', testAppearanceCount);
            console.log('Raw scores:', testScores);
            console.log('Percentages:', testPercentages);
            
            return testPercentages;
        }

        // Make debug function available globally
        window.debugSimulateProfile = debugSimulateProfile;
    </script>
</body>
</html>
